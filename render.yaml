services:
  # Backend API
  - type: web
    name: tweetgarot-backend
    env: node
    buildCommand: |
      apt-get update && apt-get install -y chromium && cd backend && npm install --production=false
    startCommand: cd backend && npm run start:production
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: PUPPETEER_SKIP_DOWNLOAD
        value: "true"
      - key: PUPPETEER_EXECUTABLE_PATH
        value: /usr/bin/chromium
      - key: ANTHROPIC_API_KEY
        sync: false  # Set this as a secret in Render dashboard
      - key: DATABASE_URL
        sync: false  # Already configured via Render database connection
      - key: JWT_SECRET
        sync: false  # Set this as a secret in Render dashboard
      # Optional: Cloudflare R2 for file storage (set in Render dashboard if needed)
      # - key: CLOUDFLARE_R2_ACCOUNT_ID
      #   sync: false
      # - key: CLOUDFLARE_R2_ACCESS_KEY_ID
      #   sync: false
      # - key: CLOUDFLARE_R2_SECRET_ACCESS_KEY
      #   sync: false
      # - key: CLOUDFLARE_R2_BUCKET_NAME
      #   sync: false

  # Frontend Static Site
  - type: web
    name: tweetgarot-frontend
    env: static
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/build
    envVars:
      - key: REACT_APP_API_URL
        value: https://tweetgarot-backend.onrender.com/api
    # Note: For SPA routing support, we use 404.html redirect technique
    # See frontend/public/404.html and frontend/public/index.html
